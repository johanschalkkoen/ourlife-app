<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OurLife Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
  <style>
    body {
      background: linear-gradient(135deg, #4B0082, #191970, #FF1493);
      font-family: 'Arial', sans-serif;
      min-height: 100vh;
      margin: 0;
      padding: 0;
      color: white;
    }
    .card {
      background: rgba(255, 255, 255, 0.1);
      border: none;
      border-radius: 10px;
      backdrop-filter: blur(10px);
    }
    .btn-primary {
      background-color: #007bff;
      border-color: #007bff;
    }
    body.old-style {
      background: #1e293b;
    }
    body.old-style .card {
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.05);
    }
    body.old-style .btn-primary {
      background-color: #14b8a6;
      border-color: #14b8a6;
    }
    body.old-style .btn-primary:hover {
      background-color: #0d9488;
      border-color: #0d9488;
    }
    body.old-style .text-success {
      color: #34d399 !important;
    }
    body.old-style .text-danger {
      color: #f87171 !important;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;

    const DEFAULT_EVENT_COLOR = '#3b82f6';

    const App = () => {
      const [user, setUser] = useState(null);
      const [page, setPage] = useState('login');

      useEffect(() => {
        document.body.className = user ? (user.style || 'new') : 'new';
      }, [user]);

      const handleLogin = (userData) => {
        setUser(userData);
        setPage('menu');
      };

      const handleLogout = () => {
        setUser(null);
        setPage('login');
      };

      return (
        <ErrorBoundary>
          {user ? (
            <>
              <Navigation user={user} setPage={setPage} onLogout={handleLogout} />
              {page === 'menu' && <Menu user={user} setPage={setPage} />}
              {page === 'profile-settings' && <ProfileSettings user={user} setUser={setUser} />}
            </>
          ) : (
            <Login onLogin={handleLogin} />
          )}
        </ErrorBoundary>
      );
    };

    const ProfileSettings = ({ user, setUser }) => {
      const [profilePicUrl, setProfilePicUrl] = useState(user.profilePicUrl || '');
      const [email, setEmail] = useState(user.email || '');
      const [phone, setPhone] = useState(user.phone || '');
      const [address, setAddress] = useState(user.address || '');
      const [eventColor, setEventColor] = useState(user.eventColor || DEFAULT_EVENT_COLOR);
      const [style, setStyle] = useState(user.style || 'new');
      const [success, setSuccess] = useState('');
      const [error, setError] = useState('');

      const saveProfile = async () => {
        try {
          await axios.post('https://ourlife.work.gd:8443/api/profile-pictures', { 
            username: user.username, 
            profilePicUrl, 
            email, 
            phone, 
            address, 
            eventColor, 
            style 
          }, { timeout: 5000 });
          setUser({ ...user, profilePicUrl, email, phone, address, eventColor, style });
          setSuccess('Profile updated successfully!');
          setTimeout(() => setSuccess(''), 3000);
        } catch (err) {
          setError('Failed to update profile.');
        }
      };

      return (
        <main className="p-4">
          <section className="card p-4">
            <h1 className="text-center mb-4">Profile Settings</h1>
            <div className="mb-3">
              <label htmlFor="email" className="form-label">Email</label>
              <input type="email" id="email" value={email} onChange={e => setEmail(e.target.value)} className="form-control" />
            </div>
            <div className="mb-3">
              <label htmlFor="phone" className="form-label">Phone</label>
              <input type="tel" id="phone" value={phone} onChange={e => setPhone(e.target.value)} className="form-control" />
            </div>
            <div className="mb-3">
              <label htmlFor="address" className="form-label">Address</label>
              <textarea id="address" value={address} onChange={e => setAddress(e.target.value)} className="form-control"></textarea>
            </div>
            <div className="mb-3">
              <label htmlFor="eventColor" className="form-label">Event Color</label>
              <input type="color" id="eventColor" value={eventColor} onChange={e => setEventColor(e.target.value)} className="form-control form-control-color" />
            </div>
            <div className="mb-3">
              <label htmlFor="style" className="form-label">Style Preference</label>
              <select id="style" value={style} onChange={e => setStyle(e.target.value)} className="form-select">
                <option value="new">New Style</option>
                <option value="old">Old Style</option>
              </select>
            </div>
            <button onClick={saveProfile} className="btn btn-primary w-100">Save Profile</button>
            {success && <div className="alert alert-success mt-3">{success}</div>}
            {error && <div className="alert alert-danger mt-3">{error}</div>}
          </section>
        </main>
      );
    };

    const Login = ({ onLogin }) => {
      const [username, setUsername] = useState('');
      const [password, setPassword] = useState('');
      const [error, setError] = useState('');

      const handleLogin = async () => {
        try {
          const response = await axios.post('https://ourlife.work.gd:8443/api/login', { username, password }, { timeout: 5000 });
          if (response.data.success) {
            onLogin(response.data);
          } else {
            setError(response.data.message || 'Login failed.');
          }
        } catch (err) {
          setError('Failed to connect to server.');
        }
      };

      return (
        <main className="d-flex justify-content-center align-items-center vh-100">
          <section className="card p-4" style={{ maxWidth: '400px', width: '100%' }}>
            <h1 className="text-center mb-4">Login</h1>
            <div className="mb-3">
              <label htmlFor="username" className="form-label">Username</label>
              <input type="text" id="username" value={username} onChange={e => setUsername(e.target.value)} className="form-control" />
            </div>
            <div className="mb-3">
              <label htmlFor="password" className="form-label">Password</label>
              <input type="password" id="password" value={password} onChange={e => setPassword(e.target.value)} className="form-control" />
            </div>
            <button onClick={handleLogin} className="btn btn-primary w-100">Login</button>
            {error && <div className="alert alert-danger mt-3">{error}</div>}
          </section>
        </main>
      );
    };

    const Navigation = ({ user, setPage, onLogout }) => (
      <nav className="navbar navbar-expand-lg navbar-dark">
        <div className="container-fluid">
          <span className="navbar-brand">OurLife Dashboard</span>
          <div className="navbar-nav">
            <button className="nav-link btn" onClick={() => setPage('menu')}>Menu</button>
            <button className="nav-link btn" onClick={() => setPage('profile-settings')}>Profile</button>
            <button className="nav-link btn" onClick={onLogout}>Logout</button>
          </div>
        </div>
      </nav>
    );

    const Menu = ({ user, setPage }) => (
      <main className="p-4">
        <section className="card p-4">
          <h1 className="text-center mb-4">Welcome, {user.username}!</h1>
          <p>This is your dashboard menu.</p>
        </section>
      </main>
    );

    const ErrorBoundary = ({ children }) => {
      const [hasError, setHasError] = useState(false);
      useEffect(() => {
        const errorHandler = (error) => {
          console.error(error);
          setHasError(true);
        };
        window.addEventListener('error', errorHandler);
        return () => window.removeEventListener('error', errorHandler);
      }, []);
      if (hasError) return <h1>Something went wrong.</h1>;
      return children;
    };

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
