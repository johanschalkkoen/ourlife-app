const Admin = ({ user, setPage }) => {
  const [allUsers, setAllUsers] = useState([]);
  const [targetUsername, setTargetUsername] = useState('');
  const [accessList, setAccessList] = useState([]);
  const [accessMessage, setAccessMessage] = useState('');
  const [isLoading, setIsLoading] = useState(false);

  // Reuse the same fetchAllUsers, fetchAccessList, handleGrantAccess, handleRevokeAccess functions
  // from ProfileSettings (you can extract them to a utility file to avoid duplication)

  useEffect(() => {
    if (user.isAdmin) {
      fetchAllUsers();
      fetchAccessList();
    }
  }, [user]);

  if (!user.isAdmin) {
    return (
      <main className="p-4 sm:p-6 max-w-4xl mx-auto">
        <section className="card p-8">
          <h1 className="text-2xl font-semibold text-white mb-6">Access Denied</h1>
          <p className="text-red-400">You do not have admin privileges.</p>
          <button
            onClick={() => setPage('menu')}
            className="mt-4 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600"
            aria-label="Back to Menu"
          >
            Back to Menu
          </button>
        </section>
      </main>
    );
  }

  return (
    <main className="p-4 sm:p-6 max-w-4xl mx-auto">
      <section className="card p-8">
        <h1 className="text-2xl font-semibold text-white mb-6">Admin Dashboard</h1>
        {/* Copy the Manage User Access section from ProfileSettings */}
        <div className="space-y-6">
          <div>
            <h3 className="text-lg font-semibold text-white mb-2">Grant View Access</h3>
            <div className="mb-4">
              <label className="block text-white text-lg font-medium mb-2">Viewer</label>
              <input
                type="text"
                value={user.username}
                disabled
                className="w-full p-3 rounded-lg bg-white/20 text-white border border-white/10"
                aria-label="Viewer Username (Current User)"
              />
            </div>
            <div className="mb-4">
              <label className="block text-white text-lg font-medium mb-2" htmlFor="targetUsername">Target User</label>
              <select
                id="targetUsername"
                value={targetUsername}
                onChange={(e) => setTargetUsername(e.target.value)}
                className="w-full p-3 rounded-lg bg-white/10 text-white border border-white/10 focus:outline-none focus:border-teal-400"
                aria-label="Select Target User"
              >
                <option value="">Select a user</option>
                {allUsers.length > 0 ? (
                  allUsers.map((username) => (
                    <option key={username} value={username}>
                      {capitalizeFirstLetter(username)}
                    </option>
                  ))
                ) : (
                  <option value="" disabled>No users available</option>
                )}
              </select>
            </div>
            <button
              onClick={handleGrantAccess}
              disabled={!targetUsername}
              className={`w-full p-3 rounded-lg text-white ${
                targetUsername ? 'bg-teal-500 hover:bg-teal-600' : 'bg-gray-500 cursor-not-allowed'
              }`}
              aria-label="Grant Access"
            >
              Grant Access
            </button>
            {accessMessage && (
              <p className={`text-center text-sm mt-2 ${accessMessage.includes('success') ? 'text-green-400' : 'text-red-400'}`}>
                {accessMessage}
              </p>
            )}
          </div>
          <div className="pt-6 border-t border-white/10">
            <h3 className="text-lg font-semibold text-white mb-2">Current Access Permissions</h3>
            {accessList.length === 0 ? (
              <p className="text-white text-center">No access permissions granted.</p>
            ) : (
              <div className="overflow-x-auto">
                <table className="w-full text-left">
                  <thead>
                    <tr className="text-gray-300">
                      <th className="p-3">Viewer</th>
                      <th className="p-3">Target</th>
                      <th className="p-3">Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    {accessList.map((access, index) => (
                      <tr key={index} className="border-t border-white/10">
                        <td className="p-3">{capitalizeFirstLetter(access.viewer)}</td>
                        <td className="p-3">{capitalizeFirstLetter(access.target)}</td>
                        <td className="p-3">
                          <button
                            onClick={() => handleRevokeAccess(access.viewer, access.target)}
                            className="text-red-400 hover:text-red-500"
                            aria-label={`Revoke access for ${access.viewer} to ${access.target}`}
                          >
                            Revoke
                          </button>
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            )}
          </div>
          <button
            onClick={() => setPage('menu')}
            className="mt-4 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600"
            aria-label="Back to Menu"
          >
            Back to Menu
          </button>
        </div>
